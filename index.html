<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªÙ…ÙˆÙŠÙ†Ø§Øª Ø£Ø¨Ùˆ Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --gray-color: #95a5a6;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„Ù†Ø¸Ø§Ù… */
        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 32px;
            color: var(--warning-color);
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .logo p {
            font-size: 14px;
            opacity: 0.9;
        }

        .profit-display {
            background-color: rgba(255, 255, 255, 0.15);
            padding: 12px 20px;
            border-radius: var(--border-radius);
            text-align: center;
            backdrop-filter: blur(5px);
        }

        .profit-display h3 {
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--light-color);
        }

        .profit-amount {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            direction: ltr;
        }

        /* Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .tab-btn {
            padding: 12px 24px;
            background-color: #f1f1f1;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            color: var(--dark-color);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background-color: #e0e0e0;
        }

        .tab-btn.active {
            background-color: var(--secondary-color);
            color: white;
        }

        .tab-btn.locked::after {
            content: " ğŸ”’";
            font-size: 12px;
        }

        /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tab-content {
            display: none;
            background-color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .form-container {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            border: 1px solid #eee;
        }

        .form-title {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #219653;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e67e22;
        }

        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table th {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: right;
            font-weight: 600;
        }

        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            text-align: right;
        }

        table tr:hover {
            background-color: #f9f9f9;
        }

        table tr.low-stock {
            background-color: #fff9e6;
        }

        table tr.low-stock:hover {
            background-color: #fff3cc;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }

        /* ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */
        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .password-modal.active {
            display: flex;
        }

        .password-box {
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .password-box h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: center;
        }

        /* ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        /* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .no-print, .tabs, .profit-display, .action-buttons {
                display: none !important;
            }
            
            .tab-content {
                display: block !important;
                box-shadow: none;
            }
            
            table {
                border: 1px solid #000;
            }
            
            table th {
                background-color: #ddd !important;
                color: #000 !important;
                -webkit-print-color-adjust: exact;
            }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .logo h1 {
                font-size: 18px;
            }
            
            .profit-display {
                padding: 8px 12px;
            }
            
            .profit-amount {
                font-size: 18px;
            }
            
            .tabs {
                justify-content: center;
            }
            
            .tab-btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-group {
                min-width: 100%;
            }
        }

        /* Ø£Ù„ÙˆØ§Ù† ÙˆØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .stat-card {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            border-top: 4px solid var(--secondary-color);
        }

        .stat-title {
            font-size: 16px;
            color: var(--gray-color);
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .section-title {
            color: var(--primary-color);
            margin: 25px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background-color: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background-color: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background-color: #f8d7da;
            color: #721c24;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .backup-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .backup-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .payment-methods {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .payment-method {
            padding: 8px 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method.active {
            border-color: var(--secondary-color);
            background-color: rgba(52, 152, 219, 0.1);
        }

        .timestamp {
            font-size: 12px;
            color: var(--gray-color);
            margin-top: 5px;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ */
        .barcode-section {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px dashed #3498db;
            margin-bottom: 15px;
        }

        .barcode-section h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .barcode-search-box {
            display: flex;
            gap: 10px;
        }

        .barcode-search-input {
            flex: 1;
        }

        .barcode-result {
            margin-top: 10px;
            padding: 10px;
            background-color: #e8f4fc;
            border-radius: var(--border-radius);
            display: none;
        }

        .barcode-result.active {
            display: block;
        }

        .barcode-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background-color: white;
            border-radius: 4px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
        <header>
            <div class="logo">
                <i class="fas fa-store"></i>
                <div>
                    <h1>ØªÙ…ÙˆÙŠÙ†Ø§Øª Ø£Ø¨Ùˆ Ù…Ø§Ù„Ùƒ Ù„Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø¨Ù‡Ø§Ø±Ø§Øª</h1>
                    <p>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¨Ø³Ø· - Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</p>
                </div>
            </div>
            <div class="profit-display">
                <h3>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
                <div class="profit-amount">0 ï·¼</div>
            </div>
        </header>

        <!-- Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="sales">
                <i class="fas fa-cash-register"></i> Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹
            </button>
            <button class="tab-btn locked" data-tab="purchases">
                <i class="fas fa-shopping-cart"></i> Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
            </button>
            <button class="tab-btn locked" data-tab="products">
                <i class="fas fa-boxes"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            </button>
            <button class="tab-btn locked" data-tab="categories">
                <i class="fas fa-tags"></i> Ø§Ù„Ø£ØµÙ†Ø§Ù
            </button>
            <button class="tab-btn locked" data-tab="units">
                <i class="fas fa-balance-scale"></i> ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³
            </button>
            <button class="tab-btn locked" data-tab="reports">
                <i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
            </button>
            <button class="tab-btn locked" data-tab="settings">
                <i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
        </div>

        <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
        <div id="passwordModal" class="password-modal">
            <div class="password-box">
                <h3><i class="fas fa-lock"></i> Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…:</label>
                    <input type="password" id="passwordInput" class="form-control" autocomplete="off" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                    <p id="passwordError" style="color: red; margin-top: 10px; display: none;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!</p>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="submitPassword" class="btn btn-primary" style="flex: 1;">Ø¯Ø®ÙˆÙ„</button>
                    <button id="cancelPassword" class="btn" style="flex: 1; background-color: #ddd;">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
                <p style="margin-top: 15px; font-size: 14px; color: #666;">
                    Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ Ù…ØªØ§Ø­Ø© Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±
                </p>
            </div>
        </div>

        <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ -->
        <div id="sales" class="tab-content active">
            <h2 class="form-title"><i class="fas fa-cash-register"></i> ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©</h2>
            
            <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
            <div class="barcode-section">
                <h4><i class="fas fa-barcode"></i> Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</h4>
                <div class="barcode-search-box">
                    <input type="text" id="barcodeSearch" class="form-control barcode-search-input" placeholder="Ø£Ø¯Ø®Ù„ Ø£Ùˆ Ù…Ø³Ø­ Ø±Ù…Ø² Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
                    <button id="scanBarcode" class="btn btn-primary">
                        <i class="fas fa-search"></i> Ø¨Ø­Ø«
                    </button>
                </div>
                <div id="barcodeResult" class="barcode-result">
                    <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>
            </div>
            
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ù†ØªØ¬ (ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯)</label>
                        <select id="saleProduct" class="form-control">
                            <option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØªØ¬ --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                        <input type="number" id="saleQuantity" class="form-control" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (ï·¼)</label>
                        <input type="text" id="salePrice" class="form-control" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬</label>
                        <input type="text" id="saleBarcode" class="form-control" placeholder="Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬" readonly>
                    </div>
                    <div class="form-group">
                        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                        <div class="payment-methods">
                            <div class="payment-method active" data-method="Ù†Ù‚Ø¯Ø§">Ù†Ù‚Ø¯Ø§</div>
                            <div class="payment-method" data-method="Ø¢Ø¬Ù„">Ø¢Ø¬Ù„</div>
                            <div class="payment-method" data-method="Ø­ÙˆØ§Ù„Ø©">Ø­ÙˆØ§Ù„Ø©</div>
                        </div>
                        <input type="hidden" id="salePaymentMethod" value="Ù†Ù‚Ø¯Ø§">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <input type="text" id="saleNotes" class="form-control" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    </div>
                </div>
                <button id="addSale" class="btn btn-success">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹
                </button>
            </div>

            <h3 class="section-title"><i class="fas fa-list"></i> Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹</h3>
            <div class="table-container">
                <table id="salesTable">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
                            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
                            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                            <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ -->
        <div id="purchases" class="tab-content">
            <h2 class="form-title"><i class="fas fa-shopping-cart"></i> ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯Ø©</h2>
            
            <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù„Ù„Ø´Ø±Ø§Ø¡ -->
            <div class="barcode-section">
                <h4><i class="fas fa-barcode"></i> Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h4>
                <div class="barcode-search-box">
                    <input type="text" id="purchaseBarcodeSearch" class="form-control barcode-search-input" placeholder="Ø£Ø¯Ø®Ù„ Ø£Ùˆ Ù…Ø³Ø­ Ø±Ù…Ø² Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
                    <button id="scanPurchaseBarcode" class="btn btn-primary">
                        <i class="fas fa-search"></i> Ø¨Ø­Ø«
                    </button>
                </div>
                <div id="purchaseBarcodeResult" class="barcode-result">
                    <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>
            </div>
            
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ù†ØªØ¬ (ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯)</label>
                        <select id="purchaseProduct" class="form-control">
                            <option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØªØ¬ --</option>
                            <option value="new">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                        <input type="number" id="purchaseQuantity" class="form-control" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (ï·¼)</label>
                        <input type="text" id="purchasePrice" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬</label>
                        <input type="text" id="purchaseBarcode" class="form-control" placeholder="Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    </div>
                    <div class="form-group">
                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <input type="text" id="purchaseNotes" class="form-control" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    </div>
                </div>
                <button id="addPurchase" class="btn btn-success">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡
                </button>
            </div>

            <h3 class="section-title"><i class="fas fa-list"></i> Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡</h3>
            <div class="table-container">
                <table id="purchasesTable">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
                            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
                            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
        <div id="products" class="tab-content">
            <h2 class="form-title"><i class="fas fa-boxes"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                        <input type="text" id="productName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ØµÙ†Ù</label>
                        <select id="productCategory" class="form-control">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³</label>
                        <select id="productUnit" class="form-control">
                            <option value="">-- Ø§Ø®ØªØ± ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ --</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (ï·¼)</label>
                        <input type="number" id="productPurchasePrice" class="form-control" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
                    </div>
                    <div class="form-group">
                        <label>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (ï·¼)</label>
                        <input type="number" id="productSalePrice" class="form-control" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†</label>
                        <input type="number" id="productMinStock" class="form-control" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†" value="5">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø±Ù…Ø² Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="productBarcode" class="form-control" placeholder="Ø±Ù…Ø² Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                            <button id="generateBarcode" class="btn btn-warning" style="white-space: nowrap;">
                                <i class="fas fa-barcode"></i> ØªÙˆÙ„ÙŠØ¯
                            </button>
                        </div>
                        <small style="color: #666; margin-top: 5px; display: block;">Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø§Ø±ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ</small>
                    </div>
                    <div class="form-group">
                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <input type="text" id="productNotes" class="form-control" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    </div>
                </div>
                <button id="addProduct" class="btn btn-success">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬
                </button>
            </div>

            <div class="search-box">
                <input type="text" id="productSearch" class="form-control" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...">
            </div>

            <div id="lowStockAlert" class="alert alert-warning" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>ØªØ­Ø°ÙŠØ±:</strong> Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.
                </div>
            </div>

            <h3 class="section-title"><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
            <div class="table-container">
                <table id="productsTable">
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th>Ø§Ù„ØµÙ†Ù</th>
                            <th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
                            <th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
                            <th>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
                            <th>ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³</th>
                            <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th>
                            <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£ØµÙ†Ø§Ù -->
        <div id="categories" class="tab-content">
            <h2 class="form-title"><i class="fas fa-tags"></i> Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h2>
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</label>
                        <input type="text" id="categoryName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
                    </div>
                    <div class="form-group">
                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <input type="text" id="categoryNotes" class="form-control" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    </div>
                </div>
                <button id="addCategory" class="btn btn-success">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù
                </button>
            </div>

            <h3 class="section-title"><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
            <div class="table-container">
                <table id="categoriesTable">
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³ -->
        <div id="units" class="tab-content">
            <h2 class="form-title"><i class="fas fa-balance-scale"></i> Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ù‚ÙŠØ§Ø³ Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³</label>
                        <input type="text" id="unitName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù…Ø² Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                        <input type="text" id="unitSymbol" class="form-control" placeholder="Ø±Ù…Ø² Ù…Ø®ØªØµØ± (Ù…Ø«Ø§Ù„: ÙƒØ¬Ù…)">
                    </div>
                </div>
                <button id="addUnit" class="btn btn-success">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³
                </button>
            </div>

            <h3 class="section-title"><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³</h3>
            <div class="table-container">
                <table id="unitsTable">
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³</th>
                            <th>Ø§Ù„Ø±Ù…Ø²</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³ ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
        <div id="reports" class="tab-content">
            <h2 class="form-title"><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h2>
            
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±</label>
                        <select id="reportMonth" class="form-control">
                            <option value="1">ÙŠÙ†Ø§ÙŠØ±</option>
                            <option value="2">ÙØ¨Ø±Ø§ÙŠØ±</option>
                            <option value="3">Ù…Ø§Ø±Ø³</option>
                            <option value="4">Ø£Ø¨Ø±ÙŠÙ„</option>
                            <option value="5">Ù…Ø§ÙŠÙˆ</option>
                            <option value="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
                            <option value="7">ÙŠÙˆÙ„ÙŠÙˆ</option>
                            <option value="8">Ø£ØºØ³Ø·Ø³</option>
                            <option value="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
                            <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
                            <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
                            <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø³Ù†Ø©</label>
                        <select id="reportYear" class="form-control">
                            <option value="2023">2023</option>
                            <option value="2024" selected>2024</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                </div>
                <button id="generateReport" class="btn btn-primary">
                    <i class="fas fa-chart-line"></i> ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
                <button id="printReport" class="btn btn-warning">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
            </div>

            <div id="reportResults" style="display: none;">
                <div class="stat-card">
                    <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
                    <div class="stat-value" id="totalSales">0 ï·¼</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
                    <div class="stat-value" id="totalPurchases">0 ï·¼</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
                    <div class="stat-value" id="netProfit">0 ï·¼</div>
                </div>
                
                <h3 class="section-title"><i class="fas fa-list"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
                <div class="table-container">
                    <table id="monthlySalesTable">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
                                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                                <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
        <div id="settings" class="tab-content">
            <h2 class="form-title"><i class="fas fa-cogs"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
            
            <div class="form-container">
                <h3><i class="fas fa-key"></i> ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                        <input type="password" id="currentPassword" class="form-control" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="newPassword" class="form-control" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="confirmPassword" class="form-control" autocomplete="off">
                    </div>
                </div>
                <button id="changePassword" class="btn btn-primary">
                    <i class="fas fa-save"></i> ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                </button>
            </div>

            <div class="backup-section">
                <h3><i class="fas fa-database"></i> Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
                <p>Ù‚Ù… Ø¨Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø£Ùˆ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø³Ø§Ø¨Ù‚Ø©.</p>
                <div class="backup-options">
                    <button id="backupData" class="btn btn-success">
                        <i class="fas fa-download"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                    </button>
                    <button id="restoreData" class="btn btn-warning">
                        <i class="fas fa-upload"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                    </button>
                    <input type="file" id="restoreFile" accept=".json" style="display: none;">
                </div>
            </div>

            <div class="form-container" style="margin-top: 20px;">
                <h3><i class="fas fa-print"></i> Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</h3>
                <p>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©.</p>
                <button id="printSystemData" class="btn btn-warning">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
                </button>
                <button onclick="window.print()" class="btn btn-primary">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                </button>
            </div>

            <div class="form-container" style="margin-top: 20px;">
                <h3><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                <p>Ù†Ø¸Ø§Ù… ØªÙ…ÙˆÙŠÙ†Ø§Øª Ø£Ø¨Ùˆ Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ø§Ù„Ù…Ø¨Ø³Ø·</p>
                <p>Ø§Ù„Ø¥ØµØ¯Ø§Ø±: 1.1.0</p>
                <p>ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ù„ØºØ© HTML Ùˆ JavaScript Ùˆ CSS</p>
                <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2024</p>
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…
        let systemData = {
            password: "123456", // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            sales: [],
            purchases: [],
            products: [],
            categories: [
                { id: 1, name: "Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª", notes: "", productCount: 0 },
                { id: 2, name: "Ø§Ù„Ø¨Ù‡Ø§Ø±Ø§Øª", notes: "", productCount: 0 },
                { id: 3, name: "Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©", notes: "", productCount: 0 }
            ],
            units: [
                { id: 1, name: "ÙƒÙŠÙ„ÙˆØºØ±Ø§Ù…", symbol: "ÙƒØ¬Ù…", productCount: 0 },
                { id: 2, name: "Ù„ØªØ±", symbol: "Ù„ØªØ±", productCount: 0 },
                { id: 3, name: "Ø¹Ù„Ø¨Ø©", symbol: "Ø¹Ù„Ø¨Ø©", productCount: 0 },
                { id: 4, name: "Ù‚Ø·Ø¹Ø©", symbol: "Ù‚Ø·Ø¹Ø©", productCount: 0 }
            ],
            currentProfit: 0,
            nextId: {
                sale: 1,
                purchase: 1,
                product: 1,
                category: 4,
                unit: 5
            }
        };

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        function loadData() {
            const savedData = localStorage.getItem('abumalikSystem');
            if (savedData) {
                systemData = JSON.parse(savedData);
                updateProfitDisplay();
                updateProductSelects();
                updateCategorySelect();
                updateUnitSelect();
                refreshTables();
                checkLowStock();
            } else {
                // Ø¥Ø¶Ø§ÙØ© Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
                addSampleData();
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        function saveData() {
            localStorage.setItem('abumalikSystem', JSON.stringify(systemData));
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function addSampleData() {
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            systemData.products = [
                { 
                    id: 1, 
                    name: "Ø£Ø±Ø² Ø¨Ø³Ù…ØªÙŠ", 
                    categoryId: 3, 
                    purchasePrice: 3500, 
                    salePrice: 4000, 
                    stock: 50, 
                    minStock: 10, 
                    unitId: 1, 
                    barcode: "123456789001", 
                    notes: "Ø£Ø±Ø² Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©" 
                },
                { 
                    id: 2, 
                    name: "Ø²Ø¹ØªØ±", 
                    categoryId: 2, 
                    purchasePrice: 2000, 
                    salePrice: 2500, 
                    stock: 30, 
                    minStock: 5, 
                    unitId: 1, 
                    barcode: "987654321002", 
                    notes: "Ø²Ø¹ØªØ± Ù†Ø§Ø¹Ù…" 
                },
                { 
                    id: 3, 
                    name: "Ù…Ø§Ø¡ Ù…Ø¹Ø¨Ø£", 
                    categoryId: 1, 
                    purchasePrice: 150, 
                    salePrice: 200, 
                    stock: 100, 
                    minStock: 20, 
                    unitId: 2, 
                    barcode: "456123789003", 
                    notes: "Ø¹Ø¨ÙˆØ© 1.5 Ù„ØªØ±" 
                },
                { 
                    id: 4, 
                    name: "Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠØ©", 
                    categoryId: 2, 
                    purchasePrice: 4500, 
                    salePrice: 5500, 
                    stock: 25, 
                    minStock: 5, 
                    unitId: 1, 
                    barcode: "789123456004", 
                    notes: "Ù‚Ù‡ÙˆØ© Ø¹Ø±Ø¨ÙŠØ© ÙØ§Ø®Ø±Ø©" 
                },
                { 
                    id: 5, 
                    name: "Ø³ÙƒØ±", 
                    categoryId: 3, 
                    purchasePrice: 1200, 
                    salePrice: 1500, 
                    stock: 80, 
                    minStock: 15, 
                    unitId: 1, 
                    barcode: "321654987005", 
                    notes: "Ø³ÙƒØ± Ù†Ø§Ø¹Ù…" 
                }
            ];
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù
            updateCategoryCounts();
            updateUnitCounts();
            
            saveData();
            updateProductSelects();
            refreshTables();
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¨Ø­
        function updateProfitDisplay() {
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ø¬Ù…ÙˆØ¹ Ø£Ø±Ø¨Ø§Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª)
            let totalProfit = 0;
            
            systemData.sales.forEach(sale => {
                const product = systemData.products.find(p => p.id === sale.productId);
                if (product) {
                    const profitPerItem = product.salePrice - product.purchasePrice;
                    totalProfit += profitPerItem * sale.quantity;
                }
            });
            
            systemData.currentProfit = totalProfit;
            
            const profitElement = document.querySelector('.profit-amount');
            profitElement.textContent = formatCurrency(totalProfit);
            
            saveData();
        }

        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„Ø©
        function formatCurrency(amount) {
            return amount.toLocaleString('ar-YE') + ' ï·¼';
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ø´Ø±Ø§Ø¡
        function updateProductSelects() {
            const saleProductSelect = document.getElementById('saleProduct');
            const purchaseProductSelect = document.getElementById('purchaseProduct');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            saleProductSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØªØ¬ --</option>';
            purchaseProductSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØªØ¬ --</option><option value="new">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</option>';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
            systemData.products.forEach(product => {
                const category = systemData.categories.find(c => c.id === product.categoryId);
                const categoryName = category ? category.name : 'ØºÙŠØ± Ù…ØµÙ†Ù';
                const unit = systemData.units.find(u => u.id === product.unitId);
                const unitSymbol = unit ? unit.symbol : '';
                
                const optionText = `${product.name} (${categoryName}) - Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${product.stock} ${unitSymbol}`;
                
                const saleOption = document.createElement('option');
                saleOption.value = product.id;
                saleOption.textContent = optionText;
                saleOption.setAttribute('data-barcode', product.barcode || '');
                saleProductSelect.appendChild(saleOption);
                
                const purchaseOption = document.createElement('option');
                purchaseOption.value = product.id;
                purchaseOption.textContent = optionText;
                purchaseOption.setAttribute('data-barcode', product.barcode || '');
                purchaseProductSelect.appendChild(purchaseOption);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù
        function updateCategorySelect() {
            const categorySelect = document.getElementById('productCategory');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            categorySelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù --</option>';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ØµÙ†Ø§Ù
            systemData.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³
        function updateUnitSelect() {
            const unitSelect = document.getElementById('productUnit');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            unitSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ --</option>';
            
            // Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³
            systemData.units.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit.id;
                option.textContent = `${unit.name} (${unit.symbol})`;
                unitSelect.appendChild(option);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ ÙƒÙ„ ØµÙ†Ù
        function updateCategoryCounts() {
            systemData.categories.forEach(category => {
                category.productCount = systemData.products.filter(p => p.categoryId === category.id).length;
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ ÙƒÙ„ ÙˆØ­Ø¯Ø© Ù‚ÙŠØ§Ø³
        function updateUnitCounts() {
            systemData.units.forEach(unit => {
                unit.productCount = systemData.products.filter(p => p.unitId === unit.id).length;
            });
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
        function checkLowStock() {
            const lowStockProducts = systemData.products.filter(p => p.stock <= p.minStock);
            const alertElement = document.getElementById('lowStockAlert');
            
            if (lowStockProducts.length > 0) {
                alertElement.style.display = 'flex';
            } else {
                alertElement.style.display = 'none';
            }
            
            // ØªØ­Ø¯ÙŠØ« ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const productRows = document.querySelectorAll('#productsTable tbody tr');
            productRows.forEach(row => {
                const productId = parseInt(row.getAttribute('data-id'));
                const product = systemData.products.find(p => p.id === productId);
                
                if (product && product.stock <= product.minStock) {
                    row.classList.add('low-stock');
                } else {
                    row.classList.remove('low-stock');
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
        function refreshTables() {
            refreshSalesTable();
            refreshPurchasesTable();
            refreshProductsTable();
            refreshCategoriesTable();
            refreshUnitsTable();
            checkLowStock();
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        function refreshSalesTable() {
            const tableBody = document.querySelector('#salesTable tbody');
            tableBody.innerHTML = '';
            
            systemData.sales.forEach(sale => {
                const product = systemData.products.find(p => p.id === sale.productId);
                if (!product) return;
                
                const category = systemData.categories.find(c => c.id === product.categoryId);
                const categoryName = category ? category.name : 'ØºÙŠØ± Ù…ØµÙ†Ù';
                
                const row = document.createElement('tr');
                row.setAttribute('data-id', sale.id);
                
                const total = sale.quantity * sale.price;
                
                row.innerHTML = `
                    <td>${sale.id}</td>
                    <td>${product.name} (${categoryName})</td>
                    <td>${product.barcode || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                    <td>${sale.quantity}</td>
                    <td>${formatCurrency(sale.price)}</td>
                    <td>${formatCurrency(total)}</td>
                    <td><span class="badge ${sale.paymentMethod === 'Ù†Ù‚Ø¯Ø§' ? 'badge-success' : sale.paymentMethod === 'Ø¢Ø¬Ù„' ? 'badge-warning' : 'badge-danger'}">${sale.paymentMethod}</span></td>
                    <td>${sale.timestamp}<div class="timestamp">${sale.date}</div></td>
                    <td>${sale.notes || ''}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-warning edit-sale"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger delete-sale"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.edit-sale').forEach(btn => {
                btn.addEventListener('click', function() {
                    const saleId = parseInt(this.closest('tr').getAttribute('data-id'));
                    editSale(saleId);
                });
            });
            
            document.querySelectorAll('.delete-sale').forEach(btn => {
                btn.addEventListener('click', function() {
                    const saleId = parseInt(this.closest('tr').getAttribute('data-id'));
                    deleteSale(saleId);
                });
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
        function refreshPurchasesTable() {
            const tableBody = document.querySelector('#purchasesTable tbody');
            tableBody.innerHTML = '';
            
            systemData.purchases.forEach(purchase => {
                const product = systemData.products.find(p => p.id === purchase.productId);
                const productName = product ? product.name : purchase.productName;
                const productBarcode = product ? product.barcode : purchase.barcode || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                
                const row = document.createElement('tr');
                row.setAttribute('data-id', purchase.id);
                
                const total = purchase.quantity * purchase.price;
                
                row.innerHTML = `
                    <td>${purchase.id}</td>
                    <td>${productName}</td>
                    <td>${productBarcode}</td>
                    <td>${purchase.quantity}</td>
                    <td>${formatCurrency(purchase.price)}</td>
                    <td>${formatCurrency(total)}</td>
                    <td>${purchase.timestamp}<div class="timestamp">${purchase.date}</div></td>
                    <td>${purchase.notes || ''}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-warning edit-purchase"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger delete-purchase"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.edit-purchase').forEach(btn => {
                btn.addEventListener('click', function() {
                    const purchaseId = parseInt(this.closest('tr').getAttribute('data-id'));
                    editPurchase(purchaseId);
                });
            });
            
            document.querySelectorAll('.delete-purchase').forEach(btn => {
                btn.addEventListener('click', function() {
                    const purchaseId = parseInt(this.closest('tr').getAttribute('data-id'));
                    deletePurchase(purchaseId);
                });
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        function refreshProductsTable() {
            const tableBody = document.querySelector('#productsTable tbody');
            tableBody.innerHTML = '';
            
            systemData.products.forEach(product => {
                const category = systemData.categories.find(c => c.id === product.categoryId);
                const categoryName = category ? category.name : 'ØºÙŠØ± Ù…ØµÙ†Ù';
                
                const unit = systemData.units.find(u => u.id === product.unitId);
                const unitSymbol = unit ? unit.symbol : '';
                
                const row = document.createElement('tr');
                row.setAttribute('data-id', product.id);
                
                if (product.stock <= product.minStock) {
                    row.classList.add('low-stock');
                }
                
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${categoryName}</td>
                    <td>${formatCurrency(product.purchasePrice)}</td>
                    <td>${formatCurrency(product.salePrice)}</td>
                    <td>${product.stock} ${unitSymbol}</td>
                    <td>${unit ? unit.name : ''}</td>
                    <td>${product.minStock}</td>
                    <td>${product.barcode || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                    <td>${product.notes || ''}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-warning edit-product"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger delete-product"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.edit-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.closest('tr').getAttribute('data-id'));
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('.delete-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.closest('tr').getAttribute('data-id'));
                    deleteProduct(productId);
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨Ø­Ø«
            const searchInput = document.getElementById('productSearch');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('#productsTable tbody tr');
                
                rows.forEach(row => {
                    const productName = row.querySelector('td:nth-child(1)').textContent.toLowerCase();
                    const categoryName = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                    const barcode = row.querySelector('td:nth-child(8)').textContent.toLowerCase();
                    
                    if (productName.includes(searchTerm) || categoryName.includes(searchTerm) || barcode.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù
        function refreshCategoriesTable() {
            const tableBody = document.querySelector('#categoriesTable tbody');
            tableBody.innerHTML = '';
            
            systemData.categories.forEach(category => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', category.id);
                
                row.innerHTML = `
                    <td>${category.name}</td>
                    <td>${category.productCount}</td>
                    <td>${category.notes || ''}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-warning edit-category"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger delete-category"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.edit-category').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryId = parseInt(this.closest('tr').getAttribute('data-id'));
                    editCategory(categoryId);
                });
            });
            
            document.querySelectorAll('.delete-category').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryId = parseInt(this.closest('tr').getAttribute('data-id'));
                    deleteCategory(categoryId);
                });
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³
        function refreshUnitsTable() {
            const tableBody = document.querySelector('#unitsTable tbody');
            tableBody.innerHTML = '';
            
            systemData.units.forEach(unit => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', unit.id);
                
                row.innerHTML = `
                    <td>${unit.name}</td>
                    <td>${unit.symbol}</td>
                    <td>${unit.productCount}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-warning edit-unit"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger delete-unit"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.edit-unit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const unitId = parseInt(this.closest('tr').getAttribute('data-id'));
                    editUnit(unitId);
                });
            });
            
            document.querySelectorAll('.delete-unit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const unitId = parseInt(this.closest('tr').getAttribute('data-id'));
                    deleteUnit(unitId);
                });
            });
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
        function getCurrentTimestamp() {
            const now = new Date();
            const date = now.toLocaleDateString('ar-YE');
            const time = now.toLocaleTimeString('ar-YE');
            return `${time} - ${date}`;
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
        function getCurrentDate() {
            return new Date().toLocaleDateString('ar-YE');
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
        function findProductByBarcode(barcode) {
            return systemData.products.find(product => product.barcode === barcode);
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        function generateBarcode() {
            const timestamp = Date.now().toString().slice(-6);
            const random = Math.floor(1000 + Math.random() * 9000);
            return timestamp + random.toString();
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹
        document.getElementById('addSale').addEventListener('click', function() {
            const productId = parseInt(document.getElementById('saleProduct').value);
            const quantity = parseInt(document.getElementById('saleQuantity').value);
            const paymentMethod = document.getElementById('salePaymentMethod').value;
            const notes = document.getElementById('saleNotes').value;
            
            if (!productId || quantity <= 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬ ÙˆØ¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©');
                return;
            }
            
            const product = systemData.products.find(p => p.id === productId);
            
            if (!product) {
                alert('Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø­Ø¯Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            if (product.stock < quantity) {
                alert(`Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†. Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©: ${product.stock}`);
                return;
            }
            
            // Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            product.stock -= quantity;
            
            // ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹
            const sale = {
                id: systemData.nextId.sale++,
                productId: productId,
                quantity: quantity,
                price: product.salePrice,
                paymentMethod: paymentMethod,
                notes: notes,
                timestamp: getCurrentTimestamp(),
                date: getCurrentDate()
            };
            
            systemData.sales.push(sale);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¹Ø±Ø¶
            saveData();
            updateProfitDisplay();
            refreshTables();
            updateProductSelects();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('saleProduct').value = '';
            document.getElementById('saleQuantity').value = 1;
            document.getElementById('salePrice').value = '';
            document.getElementById('saleBarcode').value = '';
            document.getElementById('saleNotes').value = '';
            document.getElementById('barcodeSearch').value = '';
            document.getElementById('barcodeResult').classList.remove('active');
            
            alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­');
        });

        // ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬
        document.getElementById('saleProduct').addEventListener('change', function() {
            const productId = parseInt(this.value);
            
            if (productId) {
                const product = systemData.products.find(p => p.id === productId);
                if (product) {
                    document.getElementById('salePrice').value = formatCurrency(product.salePrice);
                    document.getElementById('saleBarcode').value = product.barcode || '';
                }
            } else {
                document.getElementById('salePrice').value = '';
                document.getElementById('saleBarcode').value = '';
            }
        });

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹
        document.getElementById('scanBarcode').addEventListener('click', function() {
            const barcode = document.getElementById('barcodeSearch').value.trim();
            
            if (!barcode) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù„Ù„Ø¨Ø­Ø«');
                return;
            }
            
            const product = findProductByBarcode(barcode);
            const resultElement = document.getElementById('barcodeResult');
            
            if (product) {
                // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
                resultElement.innerHTML = `
                    <div class="barcode-info">
                        <div>
                            <strong>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬:</strong><br>
                            ${product.name}<br>
                            Ø§Ù„Ø³Ø¹Ø±: ${formatCurrency(product.salePrice)}<br>
                            Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${product.stock}
                        </div>
                        <button id="selectProductFromBarcode" class="btn btn-success" data-id="${product.id}">
                            <i class="fas fa-check"></i> Ø§Ø®ØªÙŠØ§Ø±
                        </button>
                    </div>
                `;
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø­Ø¯Ø« Ù„Ù„Ø²Ø±
                document.getElementById('selectProductFromBarcode').addEventListener('click', function() {
                    const selectedProductId = parseInt(this.getAttribute('data-id'));
                    const selectElement = document.getElementById('saleProduct');
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                    selectElement.value = selectedProductId;
                    
                    // ØªØ´ØºÙŠÙ„ Ø­Ø¯Ø« Ø§Ù„ØªØºÙŠÙŠØ± Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
                    selectElement.dispatchEvent(new Event('change'));
                    
                    // Ø¥ØºÙ„Ø§Ù‚ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø«
                    resultElement.classList.add('active');
                    
                    // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©
                    document.getElementById('saleQuantity').focus();
                });
                
                resultElement.classList.add('active');
            } else {
                resultElement.innerHTML = `
                    <div style="color: #e74c3c; text-align: center; padding: 10px;">
                        <i class="fas fa-times-circle"></i> Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
                    </div>
                `;
                resultElement.classList.add('active');
            }
        });

        // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Enter
        document.getElementById('barcodeSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('scanBarcode').click();
            }
        });

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
        document.querySelectorAll('.payment-method').forEach(method => {
            method.addEventListener('click', function() {
                document.querySelectorAll('.payment-method').forEach(m => {
                    m.classList.remove('active');
                });
                
                this.classList.add('active');
                document.getElementById('salePaymentMethod').value = this.getAttribute('data-method');
            });
        });

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
        document.getElementById('scanPurchaseBarcode').addEventListener('click', function() {
            const barcode = document.getElementById('purchaseBarcodeSearch').value.trim();
            
            if (!barcode) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù„Ù„Ø¨Ø­Ø«');
                return;
            }
            
            const product = findProductByBarcode(barcode);
            const resultElement = document.getElementById('purchaseBarcodeResult');
            
            if (product) {
                // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
                resultElement.innerHTML = `
                    <div class="barcode-info">
                        <div>
                            <strong>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬:</strong><br>
                            ${product.name}<br>
                            Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡: ${formatCurrency(product.purchasePrice)}<br>
                            Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${product.stock}
                        </div>
                        <button id="selectPurchaseProductFromBarcode" class="btn btn-success" data-id="${product.id}">
                            <i class="fas fa-check"></i> Ø§Ø®ØªÙŠØ§Ø±
                        </button>
                    </div>
                `;
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø­Ø¯Ø« Ù„Ù„Ø²Ø±
                document.getElementById('selectPurchaseProductFromBarcode').addEventListener('click', function() {
                    const selectedProductId = parseInt(this.getAttribute('data-id'));
                    const selectElement = document.getElementById('purchaseProduct');
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                    selectElement.value = selectedProductId;
                    
                    // ØªØ´ØºÙŠÙ„ Ø­Ø¯Ø« Ø§Ù„ØªØºÙŠÙŠØ± Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø±
                    selectElement.dispatchEvent(new Event('change'));
                    
                    // Ø¥ØºÙ„Ø§Ù‚ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø«
                    resultElement.classList.add('active');
                    
                    // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©
                    document.getElementById('purchaseQuantity').focus();
                });
                
                resultElement.classList.add('active');
            } else {
                resultElement.innerHTML = `
                    <div style="color: #e74c3c; text-align: center; padding: 10px;">
                        <i class="fas fa-times-circle"></i> Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯<br>
                        <button id="addNewProductWithBarcode" class="btn btn-primary" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
                        </button>
                    </div>
                `;
                resultElement.classList.add('active');
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø­Ø¯Ø« Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                document.getElementById('addNewProductWithBarcode').addEventListener('click', function() {
                    // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
                    document.getElementById('purchaseBarcode').value = barcode;
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø®ÙŠØ§Ø± Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                    document.getElementById('purchaseProduct').value = 'new';
                    
                    // Ø¥ØºÙ„Ø§Ù‚ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø«
                    resultElement.classList.remove('active');
                    
                    // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
                    document.getElementById('purchasePrice').focus();
                });
            }
        });

        // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Enter Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
        document.getElementById('purchaseBarcodeSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('scanPurchaseBarcode').click();
            }
        });

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
        document.getElementById('addPurchase').addEventListener('click', function() {
            const productSelect = document.getElementById('purchaseProduct');
            const productId = parseInt(productSelect.value);
            const quantity = parseInt(document.getElementById('purchaseQuantity').value);
            const price = parseFloat(document.getElementById('purchasePrice').value);
            const barcode = document.getElementById('purchaseBarcode').value.trim();
            const notes = document.getElementById('purchaseNotes').value;
            
            if (!productSelect.value || quantity <= 0 || price <= 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                return;
            }
            
            let actualProductId = productId;
            let productName = '';
            let actualBarcode = barcode;
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯Ø§Ù‹
            if (productSelect.value === 'new') {
                productName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯:');
                if (!productName) return;
                
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ø±ÙƒÙˆØ¯ØŒ Ù‚Ù… Ø¨ØªÙˆÙ„ÙŠØ¯ ÙˆØ§Ø­Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                if (!actualBarcode) {
                    actualBarcode = generateBarcode();
                }
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                const newProduct = {
                    id: systemData.nextId.product++,
                    name: productName,
                    categoryId: 3, // Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©
                    purchasePrice: price,
                    salePrice: Math.ceil(price * 1.2), // Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ + 20%
                    stock: quantity,
                    minStock: 5,
                    unitId: 4, // Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ù‚Ø·Ø¹Ø©
                    barcode: actualBarcode,
                    notes: notes
                };
                
                systemData.products.push(newProduct);
                actualProductId = newProduct.id;
                
                updateCategoryCounts();
                updateUnitCounts();
            } else {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                const product = systemData.products.find(p => p.id === productId);
                if (!product) {
                    alert('Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø­Ø¯Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    return;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                product.stock += quantity;
                product.purchasePrice = price; // ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø¬Ø¯ÙŠØ¯
                if (actualBarcode && actualBarcode !== product.barcode) {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„
                    const existingProductWithBarcode = findProductByBarcode(actualBarcode);
                    if (existingProductWithBarcode && existingProductWithBarcode.id !== product.id) {
                        alert('Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ù…Ù†ØªØ¬ Ø¢Ø®Ø±');
                        return;
                    }
                    product.barcode = actualBarcode;
                }
                
                productName = product.name;
                actualBarcode = product.barcode;
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡
            const purchase = {
                id: systemData.nextId.purchase++,
                productId: actualProductId,
                productName: productName,
                quantity: quantity,
                price: price,
                barcode: actualBarcode,
                notes: notes,
                timestamp: getCurrentTimestamp(),
                date: getCurrentDate()
            };
            
            systemData.purchases.push(purchase);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¹Ø±Ø¶
            saveData();
            refreshTables();
            updateProductSelects();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('purchaseProduct').value = '';
            document.getElementById('purchaseQuantity').value = 1;
            document.getElementById('purchasePrice').value = '';
            document.getElementById('purchaseBarcode').value = '';
            document.getElementById('purchaseNotes').value = '';
            document.getElementById('purchaseBarcodeSearch').value = '';
            document.getElementById('purchaseBarcodeResult').classList.remove('active');
            
            alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­');
        });

        // ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬
        document.getElementById('purchaseProduct').addEventListener('change', function() {
            const productId = parseInt(this.value);
            
            if (productId && this.value !== 'new') {
                const product = systemData.products.find(p => p.id === productId);
                if (product) {
                    document.getElementById('purchasePrice').value = product.purchasePrice;
                    document.getElementById('purchaseBarcode').value = product.barcode || '';
                }
            } else {
                document.getElementById('purchasePrice').value = '';
                document.getElementById('purchaseBarcode').value = '';
            }
        });

        // ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
        document.getElementById('generateBarcode').addEventListener('click', function() {
            const barcodeField = document.getElementById('productBarcode');
            if (!barcodeField.value.trim()) {
                barcodeField.value = generateBarcode();
            } else {
                alert('Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ØºÙŠØ± ÙØ§Ø±Øº. ÙŠØ±Ø¬Ù‰ Ù…Ø³Ø­Ù‡ Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯ ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯.');
            }
        });

        // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
        document.getElementById('addProduct').addEventListener('click', function() {
            const name = document.getElementById('productName').value;
            const categoryId = parseInt(document.getElementById('productCategory').value);
            const unitId = parseInt(document.getElementById('productUnit').value);
            const purchasePrice = parseFloat(document.getElementById('productPurchasePrice').value);
            const salePrice = parseFloat(document.getElementById('productSalePrice').value);
            const minStock = parseInt(document.getElementById('productMinStock').value);
            let barcode = document.getElementById('productBarcode').value.trim();
            const notes = document.getElementById('productNotes').value;
            
            if (!name || !categoryId || !unitId || !purchasePrice || !salePrice) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            if (salePrice <= purchasePrice) {
                alert('Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡');
                return;
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ø±ÙƒÙˆØ¯ØŒ Ù‚Ù… Ø¨ØªÙˆÙ„ÙŠØ¯ ÙˆØ§Ø­Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            if (!barcode) {
                barcode = generateBarcode();
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„
            const existingProduct = findProductByBarcode(barcode);
            if (existingProduct) {
                alert('Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ù…Ù†ØªØ¬ Ø¢Ø®Ø±');
                return;
            }
            
            const product = {
                id: systemData.nextId.product++,
                name: name,
                categoryId: categoryId,
                purchasePrice: purchasePrice,
                salePrice: salePrice,
                stock: 0,
                minStock: minStock || 5,
                unitId: unitId,
                barcode: barcode,
                notes: notes
            };
            
            systemData.products.push(product);
            
            updateCategoryCounts();
            updateUnitCounts();
            saveData();
            updateProductSelects();
            refreshTables();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productUnit').value = '';
            document.getElementById('productPurchasePrice').value = '';
            document.getElementById('productSalePrice').value = '';
            document.getElementById('productMinStock').value = '5';
            document.getElementById('productBarcode').value = '';
            document.getElementById('productNotes').value = '';
            
            alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');
        });

        // Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯
        document.getElementById('addCategory').addEventListener('click', function() {
            const name = document.getElementById('categoryName').value;
            const notes = document.getElementById('categoryNotes').value;
            
            if (!name) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù');
                return;
            }
            
            const category = {
                id: systemData.nextId.category++,
                name: name,
                notes: notes,
                productCount: 0
            };
            
            systemData.categories.push(category);
            saveData();
            updateCategorySelect();
            refreshCategoriesTable();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('categoryName').value = '';
            document.getElementById('categoryNotes').value = '';
            
            alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­');
        });

        // Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ù‚ÙŠØ§Ø³ Ø¬Ø¯ÙŠØ¯Ø©
        document.getElementById('addUnit').addEventListener('click', function() {
            const name = document.getElementById('unitName').value;
            const symbol = document.getElementById('unitSymbol').value;
            
            if (!name || !symbol) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ÙˆØ­Ø¯Ø© ÙˆØ±Ù…Ø²Ù‡Ø§');
                return;
            }
            
            const unit = {
                id: systemData.nextId.unit++,
                name: name,
                symbol: symbol,
                productCount: 0
            };
            
            systemData.units.push(unit);
            saveData();
            updateUnitSelect();
            refreshUnitsTable();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('unitName').value = '';
            document.getElementById('unitSymbol').value = '';
            
            alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ø¨Ù†Ø¬Ø§Ø­');
        });

        // ØªØ­Ø±ÙŠØ± Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹
        function editSale(saleId) {
            const sale = systemData.sales.find(s => s.id === saleId);
            if (!sale) return;
            
            const newQuantity = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:', sale.quantity);
            if (!newQuantity || isNaN(newQuantity)) return;
            
            const product = systemData.products.find(p => p.id === sale.productId);
            if (!product) return;
            
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            product.stock += sale.quantity;
            product.stock -= parseInt(newQuantity);
            
            if (product.stock < 0) {
                alert('Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ØªØ§Ø­');
                product.stock += parseInt(newQuantity);
                product.stock -= sale.quantity;
                return;
            }
            
            sale.quantity = parseInt(newQuantity);
            sale.timestamp = getCurrentTimestamp();
            
            saveData();
            updateProfitDisplay();
            refreshTables();
            updateProductSelects();
            
            alert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹
        function deleteSale(saleId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ Ù‡Ø°Ù‡ØŸ')) return;
            
            const saleIndex = systemData.sales.findIndex(s => s.id === saleId);
            if (saleIndex === -1) return;
            
            const sale = systemData.sales[saleIndex];
            const product = systemData.products.find(p => p.id === sale.productId);
            
            if (product) {
                // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                product.stock += sale.quantity;
            }
            
            systemData.sales.splice(saleIndex, 1);
            
            saveData();
            updateProfitDisplay();
            refreshTables();
            updateProductSelects();
            
            alert('ØªÙ… Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØ­Ø±ÙŠØ± Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡
        function editPurchase(purchaseId) {
            const purchase = systemData.purchases.find(p => p.id === purchaseId);
            if (!purchase) return;
            
            const newQuantity = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:', purchase.quantity);
            const newPrice = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯:', purchase.price);
            
            if (!newQuantity || !newPrice || isNaN(newQuantity) || isNaN(newPrice)) return;
            
            const product = systemData.products.find(p => p.id === purchase.productId);
            
            if (product) {
                // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                product.stock -= purchase.quantity;
                product.stock += parseInt(newQuantity);
                
                product.purchasePrice = parseFloat(newPrice);
            }
            
            purchase.quantity = parseInt(newQuantity);
            purchase.price = parseFloat(newPrice);
            purchase.timestamp = getCurrentTimestamp();
            
            saveData();
            refreshTables();
            updateProductSelects();
            
            alert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡
        function deletePurchase(purchaseId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ Ù‡Ø°Ù‡ØŸ')) return;
            
            const purchaseIndex = systemData.purchases.findIndex(p => p.id === purchaseId);
            if (purchaseIndex === -1) return;
            
            const purchase = systemData.purchases[purchaseIndex];
            const product = systemData.products.find(p => p.id === purchase.productId);
            
            if (product) {
                // Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                product.stock -= purchase.quantity;
            }
            
            systemData.purchases.splice(purchaseIndex, 1);
            
            saveData();
            refreshTables();
            updateProductSelects();
            
            alert('ØªÙ… Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØ­Ø±ÙŠØ± Ù…Ù†ØªØ¬
        function editProduct(productId) {
            const product = systemData.products.find(p => p.id === productId);
            if (!product) return;
            
            const newName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:', product.name);
            if (!newName) return;
            
            const newPurchasePrice = prompt('Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯:', product.purchasePrice);
            const newSalePrice = prompt('Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯:', product.salePrice);
            const newMinStock = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯:', product.minStock);
            const newBarcode = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯:', product.barcode || '');
            
            if (!newPurchasePrice || !newSalePrice || isNaN(newPurchasePrice) || isNaN(newSalePrice)) return;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„
            if (newBarcode && newBarcode !== product.barcode) {
                const existingProduct = findProductByBarcode(newBarcode);
                if (existingProduct && existingProduct.id !== product.id) {
                    alert('Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ù…Ù†ØªØ¬ Ø¢Ø®Ø±');
                    return;
                }
            }
            
            product.name = newName;
            product.purchasePrice = parseFloat(newPurchasePrice);
            product.salePrice = parseFloat(newSalePrice);
            product.minStock = parseInt(newMinStock) || 5;
            product.barcode = newBarcode;
            
            saveData();
            refreshTables();
            updateProductSelects();
            
            alert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Ø­Ø°Ù Ù…Ù†ØªØ¬
        function deleteProduct(productId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡.')) return;
            
            const productIndex = systemData.products.findIndex(p => p.id === productId);
            if (productIndex === -1) return;
            
            // Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…Ù†ØªØ¬
            systemData.sales = systemData.sales.filter(s => s.productId !== productId);
            
            // Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…Ù†ØªØ¬
            systemData.purchases = systemData.purchases.filter(p => p.productId !== productId);
            
            systemData.products.splice(productIndex, 1);
            
            updateCategoryCounts();
            updateUnitCounts();
            saveData();
            updateProfitDisplay();
            refreshTables();
            updateProductSelects();
            
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØ­Ø±ÙŠØ± ØµÙ†Ù
        function editCategory(categoryId) {
            const category = systemData.categories.find(c => c.id === categoryId);
            if (!category) return;
            
            const newName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:', category.name);
            if (!newName) return;
            
            category.name = newName;
            
            saveData();
            refreshTables();
            updateCategorySelect();
            
            alert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Ø­Ø°Ù ØµÙ†Ù
        function deleteCategory(categoryId) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ù
            const productsInCategory = systemData.products.filter(p => p.categoryId === categoryId);
            
            if (productsInCategory.length > 0) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ù Ù„Ø£Ù†Ù‡ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬Ø§Øª. ÙŠØ±Ø¬Ù‰ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Ø£ØµÙ†Ø§Ù Ø£Ø®Ø±Ù‰ Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†ÙØŸ')) return;
            
            const categoryIndex = systemData.categories.findIndex(c => c.id === categoryId);
            if (categoryIndex === -1) return;
            
            systemData.categories.splice(categoryIndex, 1);
            saveData();
            refreshTables();
            updateCategorySelect();
            
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØ­Ø±ÙŠØ± ÙˆØ­Ø¯Ø© Ù‚ÙŠØ§Ø³
        function editUnit(unitId) {
            const unit = systemData.units.find(u => u.id === unitId);
            if (!unit) return;
            
            const newName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:', unit.name);
            const newSymbol = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯:', unit.symbol);
            
            if (!newName || !newSymbol) return;
            
            unit.name = newName;
            unit.symbol = newSymbol;
            
            saveData();
            refreshTables();
            updateUnitSelect();
            
            alert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Ø­Ø°Ù ÙˆØ­Ø¯Ø© Ù‚ÙŠØ§Ø³
        function deleteUnit(unitId) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ­Ø¯Ø©
            const productsUsingUnit = systemData.products.filter(p => p.unitId === unitId);
            
            if (productsUsingUnit.length > 0) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ù‡Ø°Ù‡ Ù„Ø£Ù†Ù‡Ø§ Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ù…Ù†ØªØ¬Ø§Øª. ÙŠØ±Ø¬Ù‰ ØªØºÙŠÙŠØ± ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ù‡Ø°Ù‡ØŸ')) return;
            
            const unitIndex = systemData.units.findIndex(u => u.id === unitId);
            if (unitIndex === -1) return;
            
            systemData.units.splice(unitIndex, 1);
            saveData();
            refreshTables();
            updateUnitSelect();
            
            alert('ØªÙ… Ø­Ø°Ù ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
        document.getElementById('generateReport').addEventListener('click', function() {
            const month = parseInt(document.getElementById('reportMonth').value);
            const year = parseInt(document.getElementById('reportYear').value);
            
            // ØªØµÙÙŠØ© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©
            const monthlySales = systemData.sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate.getMonth() + 1 === month && saleDate.getFullYear() === year;
            });
            
            // ØªØµÙÙŠØ© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©
            const monthlyPurchases = systemData.purchases.filter(purchase => {
                const purchaseDate = new Date(purchase.date);
                return purchaseDate.getMonth() + 1 === month && purchaseDate.getFullYear() === year;
            });
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
            let totalSales = 0;
            let totalPurchases = 0;
            
            monthlySales.forEach(sale => {
                totalSales += sale.quantity * sale.price;
            });
            
            monthlyPurchases.forEach(purchase => {
                totalPurchases += purchase.quantity * purchase.price;
            });
            
            const netProfit = totalSales - totalPurchases;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            document.getElementById('totalSales').textContent = formatCurrency(totalSales);
            document.getElementById('totalPurchases').textContent = formatCurrency(totalPurchases);
            document.getElementById('netProfit').textContent = formatCurrency(netProfit);
            
            // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
            const tableBody = document.querySelector('#monthlySalesTable tbody');
            tableBody.innerHTML = '';
            
            monthlySales.forEach(sale => {
                const product = systemData.products.find(p => p.id === sale.productId);
                const productName = product ? product.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const productBarcode = product ? product.barcode : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                
                const total = sale.quantity * sale.price;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.date}</td>
                    <td>${productName}</td>
                    <td>${productBarcode}</td>
                    <td>${sale.quantity}</td>
                    <td>${formatCurrency(sale.price)}</td>
                    <td>${formatCurrency(total)}</td>
                    <td>${sale.paymentMethod}</td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            document.getElementById('reportResults').style.display = 'block';
            
            alert(`ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù€ ${month}/${year}`);
        });

        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        document.getElementById('printReport').addEventListener('click', function() {
            window.print();
        });

        // ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        document.getElementById('changePassword').addEventListener('click', function() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            if (currentPassword !== systemData.password) {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ£ÙƒÙŠØ¯Ù‡Ø§ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†');
                return;
            }
            
            systemData.password = newPassword;
            saveData();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            alert('ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
        });

        // Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        document.getElementById('backupData').addEventListener('click', function() {
            const dataStr = JSON.stringify(systemData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `Ù†Ø³Ø®Ø©_Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©_ØªÙ…ÙˆÙŠÙ†Ø§Øª_Ø£Ø¨Ùˆ_Ù…Ø§Ù„Ùƒ_${new Date().toLocaleDateString('ar-YE')}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
        });

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        document.getElementById('restoreData').addEventListener('click', function() {
            document.getElementById('restoreFile').click();
        });

        document.getElementById('restoreFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!confirm('ØªØ­Ø°ÙŠØ±: Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø³ØªØ­Ù„ Ù…Ø­Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                this.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const restoredData = JSON.parse(e.target.result);
                    systemData = restoredData;
                    saveData();
                    loadData();
                    
                    alert('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                } catch (error) {
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ù„Ù.');
                }
            };
            
            reader.readAsText(file);
            this.value = '';
        });

        // Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        document.getElementById('printSystemData').addEventListener('click', function() {
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ
            const currentTab = document.querySelector('.tab-content.active');
            const currentTabId = currentTab.id;
            
            // Ø¹Ø±Ø¶ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById('products').classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === 'products') {
                    btn.classList.add('active');
                }
            });
            
            // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµÙØ­Ø©
            setTimeout(() => {
                window.print();
                
                // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³Ø§Ø¨Ù‚
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.getElementById(currentTabId).classList.add('active');
                
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('data-tab') === currentTabId) {
                        btn.classList.add('active');
                    }
                });
            }, 500);
        });

        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØµÙˆÙ„ (ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±)
        let currentTabToUnlock = '';
        const passwordModal = document.getElementById('passwordModal');
        const passwordInput = document.getElementById('passwordInput');
        const passwordError = document.getElementById('passwordError');
        const submitPassword = document.getElementById('submitPassword');
        const cancelPassword = document.getElementById('cancelPassword');

        // ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù‡Ùˆ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ØŒ ÙØ§ÙØªØ­Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø©
                if (tabId === 'sales') {
                    openTab(tabId, this);
                    return;
                }
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù…Ù‚ÙÙ„Ø§Ù‹ØŒ ÙØ§Ø·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                if (this.classList.contains('locked')) {
                    currentTabToUnlock = tabId;
                    passwordModal.classList.add('active');
                    passwordInput.focus();
                } else {
                    openTab(tabId, this);
                }
            });
        });

        // ÙØªØ­ ØªØ¨ÙˆÙŠØ¨
        function openTab(tabId, button) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(tabId).classList.add('active');
            button.classList.add('active');
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù‡Ùˆ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ØŒ Ù‚Ù… Ø¨Ø¥Ù‚ÙØ§Ù„Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
            if (tabId !== 'sales') {
                button.classList.add('locked');
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        submitPassword.addEventListener('click', function() {
            if (passwordInput.value === systemData.password) {
                // ÙØªØ­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                const button = document.querySelector(`.tab-btn[data-tab="${currentTabToUnlock}"]`);
                button.classList.remove('locked');
                openTab(currentTabToUnlock, button);
                
                // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                passwordModal.classList.remove('active');
                passwordInput.value = '';
                passwordError.style.display = 'none';
            } else {
                passwordError.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
            }
        });

        // Ø¥Ù„ØºØ§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        cancelPassword.addEventListener('click', function() {
            passwordModal.classList.remove('active');
            passwordInput.value = '';
            passwordError.style.display = 'none';
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Esc
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && passwordModal.classList.contains('active')) {
                passwordModal.classList.remove('active');
                passwordInput.value = '';
                passwordError.style.display = 'none';
            }
        });

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            // ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
            const salesTabBtn = document.querySelector('.tab-btn[data-tab="sales"]');
            openTab('sales', salesTabBtn);
            
            // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¹Ù†Ø¯ ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¨ÙŠØ¹
            document.getElementById('barcodeSearch').focus();
        });
    </script>
</body>
</html>